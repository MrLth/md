# TCP

​	HTTP 和 WebSocket 都是基于 TCP/IP 协议的

# IP

​	网际协议，`Internel Protocol`

## IP头

​	如果想要把一个数据包从 主机A 发送给 主机B，那么在传输之前，数据包会被附加上 主机B 的 IP 地址信息，这样在传输过程中才能够正确寻址。额外的，数据包上还会附加上 主机A 本身的 IP 地址，有了这些信息，主机B 才能正确回复 主机A。这些附加的信息就被存放在 IP 头里，IP 头 是 IP 数据包开头的信息，包含 IP 版本、源IP地址、目标IP地址、生存时间等信息。

# UDP

​	用户数据包协议，`User Datagram Protocol`，IP 协议负责将数据包传输给对方电脑，而 UDP 协议负责将数据包交给对应的应用。

​	**UDP 协议不提供重发机制**，UDP协议虽然可以校验数据是否正确，但对于错误的数据包，UDP 并不提供重发机制，只是丢弃当前包，而且 UDP 协议在发送之后也无法知道是否到达目的地

​	**UDP 不提供数据包排序机制**， 无法保证数据包是有序的，也就无法组装成完整的文件

​	虽说 **UDP 不能保证数据的可靠性传输，但是传输速度相当快**，所以 UDP 会应用在一些关注速度，对数据完整性要求不高的领域，如在线视频、互动游戏等

## 端口号

​	每个想访问网络的程序都需要绑定一个端口号，通过端口号 UDP 协议就可以把指定的数据包发送给指定的应用了，和 IP 头一样，端口号会被装进 UDP 头

<img src="https://static001.geekbang.org/resource/image/3e/ea/3edb673a43f23d84253c52124ce447ea.png" style="zoom:50%;" />

# TCP

​	传输控制协议，`Transmission Control Protocol`，是一种面向连接的、可靠的、基于字节流的传输层通信协议。

​	相比于 UDP，TCP 有以下优点：

1. 对于数据包丢失的情况，TCP 提供重传机制
2. TCP 引入了数据包排序机制，用来保证把乱序的数据包组合成一个完整的文件

## 序列号

​	和 UDP 头一样， TCP 头除了包含了目标端口和本机端口，还提供了用于排序的序列号，以便接收端通过序号来重排数据包

## TCP 连接的建立和销毁

1. 三次握手建立连接
2. 数据传输阶段，提供 **超时重传** 服务。接收端需要对每个数据包进行确认操作，也就是接收端收到数据包后，需要发送确认数据包给发送端。所以发送端在发送了一个数据包后，在规定时间内没有收到确认接收包，就认定该数据包已丢失，触发超时重传机制。
3. 四次挥手断开连接

<img src="https://static001.geekbang.org/resource/image/44/44/440ee50de56edc27c6b3c992b3a25844.png" style="zoom:50%;" />

# 零碎知识点

1. 浏览器可以打开多个标签页，这些标签页都使用同一个端口，网络进程知道每个 TCP 连接对应的标签，所以在收到数据后，会把数据分发给对应的渲染进程
2. TCP 在接收到 HTTP 响应头的 Content-type 类型时，就开始准备渲染进程了。响应体一旦开始接收，就开始做 DOM 解析了（TCP 保证了数据的有序有效的传输）
3. HTTP 和 WebSocket 都属于应用层协议，TCP 属于传输层，WebSocket 和 socket 并不一样，而是基于 HTTP 的改造版本，增加了服务器向客户端主动发送消息的能力
4. TCP 心跳包，客户端每隔一段时间发送一个数据包给服务器，以此来告诉服务器，这个客户端还活着，连接应该保持，另外就是有的节点（防火墙）会自动把一定时间内没有数据交互的连接断掉。
   1. 当TCP两端 A、B 建立连接后，如果一端拨掉网线或者拔掉电源，另一端无法收到通知。因为 TCP 连接只是一个虚拟的电路，组成这个电路的路由器是不知道发送的是什么，只是将数据发送到目的地。